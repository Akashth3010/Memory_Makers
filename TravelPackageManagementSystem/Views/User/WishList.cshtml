@{
    ViewData["Title"] = "My Wishlist";
    Layout = "_Layout";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header d-flex align-items-center justify-content-between">
                    <div>
                        <h5 class="mb-0">Wishlist</h5>
                        <small class="text-muted">Saved favorites — hotels, packages and experiences</small>
                    </div>
                    <div>
                        <button id="clearAllBtn" class="btn btn-sm btn-outline-danger">Clear All</button>
                    </div>
                </div>

                <div class="card-body">
                    <div id="wishlistEmpty" class="text-center py-5 text-muted" style="display:none;">
                        <i class="fa-regular fa-heart fa-2x mb-3"></i>
                        <div>No items in your wishlist yet.</div>
                        <div class="mt-2"><a href="/" class="btn btn-sm btn-primary">Browse packages</a></div>
                    </div>

                    <ul id="wishlistList" class="list-group list-group-flush"></ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Wishlist item shape expected: { id: string|number, title: string, subtitle?: string, href?: string, img?: string }
    (function () {
        const STORAGE_KEY = 'wishlist';

        function loadWishlist() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                return raw ? JSON.parse(raw) : [];
            } catch (e) {
                console.error('Failed to parse wishlist', e);
                return [];
            }
        }

        function saveWishlist(items) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
        }

        function render() {
            const items = loadWishlist();
            const listEl = document.getElementById('wishlistList');
            const emptyEl = document.getElementById('wishlistEmpty');

            listEl.innerHTML = '';

            if (!items || items.length === 0) {
                emptyEl.style.display = '';
                return;
            } else {
                emptyEl.style.display = 'none';
            }

            items.forEach((it, idx) => {
                const li = document.createElement('li');
                li.className = 'list-group-item d-flex align-items-start gap-3';

                // thumbnail (optional)
                const thumb = document.createElement('div');
                thumb.style.width = '64px';
                thumb.style.height = '64px';
                thumb.style.flex = '0 0 64px';
                thumb.style.borderRadius = '6px';
                thumb.style.background = '#f5f7fb';
                thumb.style.display = 'flex';
                thumb.style.alignItems = 'center';
                thumb.style.justifyContent = 'center';
                if (it.img) {
                    const img = document.createElement('img');
                    img.src = it.img;
                    img.alt = it.title || 'item';
                    img.style.maxWidth = '100%';
                    img.style.maxHeight = '100%';
                    img.style.borderRadius = '6px';
                    thumb.appendChild(img);
                } else {
                    thumb.innerHTML = '<i class="fa-regular fa-heart" style="color:#ef4444;"></i>';
                }

                const content = document.createElement('div');
                content.style.flex = '1';

                const title = document.createElement('div');
                title.className = 'fw-bold';
                title.textContent = it.title || 'Untitled';

                const subtitle = document.createElement('div');
                subtitle.className = 'text-muted small';
                subtitle.textContent = it.subtitle || '';

                content.appendChild(title);
                if (it.subtitle) content.appendChild(subtitle);

                const actions = document.createElement('div');
                actions.style.marginLeft = '12px';
                actions.style.display = 'flex';
                actions.style.flexDirection = 'column';
                actions.style.gap = '6px';

                const viewBtn = document.createElement('a');
                viewBtn.className = 'btn btn-sm btn-outline-primary';
                viewBtn.textContent = 'View';
                viewBtn.href = it.href || '#';
                viewBtn.onclick = function (e) {
                    if (!it.href) e.preventDefault();
                };

                const removeBtn = document.createElement('button');
                removeBtn.className = 'btn btn-sm btn-outline-danger';
                removeBtn.textContent = 'Remove';
                removeBtn.addEventListener('click', function () {
                    removeAt(idx);
                });

                actions.appendChild(viewBtn);
                actions.appendChild(removeBtn);

                li.appendChild(thumb);
                li.appendChild(content);
                li.appendChild(actions);

                listEl.appendChild(li);
            });
        }

        function removeAt(index) {
            const items = loadWishlist();
            if (index < 0 || index >= items.length) return;
            items.splice(index, 1);
            saveWishlist(items);
            render();
        }

        function clearAll() {
            if (!confirm('Clear all wishlist items?')) return;
            localStorage.removeItem(STORAGE_KEY);
            render();
        }

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('clearAllBtn').addEventListener('click', clearAll);
            render();
        });

        // expose for quick testing in console (optional)
        window.__wishlist = {
            load: loadWishlist,
            save: saveWishlist,
            render: render,
            add: function (item) { const a = loadWishlist(); a.push(item); saveWishlist(a); render(); }
        };
    })();
</script>